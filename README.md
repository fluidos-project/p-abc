# P-ABC

P-ABC library (distributed privacy-preserving Attribute-Based Credentials based on [PS multisignatures](https://eprint.iacr.org/2020/016)) using wrapper library for [EC arithmetic](./lib/pfecCwrapper/README.md).


## Instalation and build
The project is based on cmake, and should work for both linux and windows platforms (with small potential issues that are detailed in other parts of the doc). The build process is the same as with other cmake projects:
```sh
mkdir build
cd build
cmake ..
```
Compile from generated Makefile (In build directory):
```sh
make
```
There is a configuration parameter that establishes the specific wrapper instantiation that will be used for building the dpabc implementation. The previous commands will build the dpabc library with the default value (**NOTE** Once you have set the variable, it is stored in CMake cache, so even if you run *cmake ..* without arguments it will use the last value you set for the variable). Currently, you can choose between two instantiations of the pfecCwrapper library:
* "pfec_Miracl_Bls381_64": (**Default** value) Instantiataion of the BLS381 curve with a 64 bit representation (i.e., for better performance in 64 bit architectures), based on the [Miracle/core](https://github.com/miracl/core/tree/master/c) library. 
* "pfec_Miracl_Bls381_32": Instantiataion of the BLS381 curve with a 32 bit representation (i.e., for 32 bit architectures), based on the [Miracle/core](https://github.com/miracl/core/tree/master/c) library.

To do this, specify the instantiation on the cmake command as variable WRAPPER_INSTANTIATION. For instance, you can execute:
```sh
cd build
cmake -DWRAPPER_INSTANTIATION=pfec_Miracl_Bls381_32 ..
make
```

### Testing
The project supports testing of both the wrapper library and the dpabc implementation. Tests will be built by default, if you wish to disable it you need to comment the respective lines in the CMakeLists.txt files (plans for adding a configurable option in the future). 

Testing is based on the cmocka library. To be able to properly generate and run tests you need to complete the installation steps for cmocka, whichi is included in pfecCwrapper/test/cmocka/INSTALL.md (if you are on Windows, you will have to update the path to the cmocka dll in CMakeLists.txt for correct execution of the tests, or manually copy the dll to the build directory).
Once everything is built correctly, you can (verbosely) run the tests with the command (inside the build directory):
```sh
ctest -V
```

### Outputs
An example binary with a simple protocol execution will be generated to *build/output/bin* directory. Additionally, a static library for the dpabc code will be generated to *build/output/lib*. 
For convenience, the static library along with all the static libraries that it will need (i.e., wrapper ec library), are bundled into the file *build/libdpabc_psms_bundled.a*. 

Remember that, in both cases, if you want to use the methods for these libraries in your code you need to include the respective headers (i.e., those in the *include* directories from both projects).

For instance, if your *main.c* file (you can try it with the *src/example/main.c* from this project) uses the library, you may execute the following command (with each directory containing the corresponding files):
```
gcc.exe -I./include -I./include/ecwrapper main.c -L. -ldpabc_psms_bundled  
```

If you do not use the bundled library, you would need to include all the static libraries in the bundled directory:
```
 gcc.exe -I./include -I./include/ecwrapper main.c -L. -ldpabc_psms_bundled  -lpfec_Miracl_Bls381_64   -lcore_win  
```

## Documentation
You can genereta a documentation for the whole library by running *doxygen* in the docs folder


## Potential issues
The aforementioned potential issues with cmocka in Windows.

If there is a linking error with Miracl/core's library, you need to substitute the correspoinding static labrary (e.g., core_win.a) for the one generated by following the compilation steps on their repository [Miracle/core](https://github.com/miracl/core/tree/master/c)
